#include "AccelStepper.h" 
// AccelStepper Setup
AccelStepper stepperX(1, 4, 3);   // 1 = Easy Driver interface NANO Pin 4 connected to STEP pin of Easy Driver NANO Pin 3 connected to DIR pin of Easy Driver
AccelStepper steppery(1, 5, 6);   // 1 = Easy Driver interface NANO Pin 5 connected to STEP pin of Easy Driver NANO Pin 2 connected to DIR pin of Easy Driver

#define xSwitch 12 // Pin 12 connected to Home Switch (MicroSwitch)
#define ySwitch 13 // Pin 13 connected to  (MicroSwitch)
#define Hall_sensor 22
//=====================================================================================================
long TravelX;
long Travely;
int  state;
int  stateH;    
int  move_finished = 1;
//=====================================================================================================  
long initial_homing  = -1;  
long initial_homingy =  1;
//=====================================================================================================  
void setup() 
{
      pinMode(Hall_sensor, INPUT_PULLUP);
      Serial.begin(9600); 
      //=====================================================================================================
      pinMode(xSwitch, INPUT_PULLUP);
      pinMode(ySwitch, INPUT_PULLUP);
      //pinMode(HallEffectA1,INPUT);
     //delay(2);
      //=====================================================================================================
      stepperX.setMaxSpeed(1000.0);
      steppery.setMaxSpeed(1000.0);
      stepperX.setAcceleration(1000.0);
      steppery.setAcceleration(1000.0);
       //=====================================================================================================
      Serial.println("Stepper is Homing . . . . . . . . . . . ");
      //=====================================================================================================
      while (digitalRead(ySwitch)) 
      {    
          steppery.moveTo(initial_homingy); 
          stepperX.moveTo(initial_homing);
          initial_homingy--;
          initial_homing++;
          steppery.run();
          stepperX.run();
      }
      //=====================================================================================================
      steppery.setCurrentPosition(0);  
      steppery.setMaxSpeed(1000.0);  
      stepperX.setMaxSpeed(1000.0);
      steppery.setAcceleration(1000.0);
      stepperX.setAcceleration(1000.0);
      initial_homing  =  1;
      initial_homingy = -1;
      //=====================================================================================================
      while (!digitalRead(ySwitch)) 
      {
          steppery.moveTo(initial_homingy);  
          stepperX.moveTo(initial_homing);  
          steppery.run();
          stepperX.run();
          initial_homing--;
          initial_homingy++;         
      }
     
      steppery.setCurrentPosition(0);
      stepperX.setCurrentPosition(0);
      Serial.println("Found Y-Limit");
      //=====================================================================================================
      //=====================================================================================================
      //=====================================================================================================
      //=====================================================================================================
      initial_homing  = -1; 
      initial_homingy =  1;
      steppery.setMaxSpeed(1000.0);  
      stepperX.setMaxSpeed(1000.0);
      stepperX.setAcceleration(1000.0);
      steppery.setAcceleration(1000.0);
      //=====================================================================================================
      while (digitalRead(xSwitch)) 
      { 
          steppery.moveTo(initial_homing); 
          stepperX.moveTo(initial_homing);
          initial_homing++;  
          steppery.run();
          stepperX.run();
      }
      //=====================================================================================================
      steppery.setCurrentPosition(0);
      stepperX.setCurrentPosition(0);  
      steppery.setMaxSpeed(1000.0);  
      stepperX.setMaxSpeed(1000.0);
      stepperX.setAcceleration(1000.0);
      steppery.setAcceleration(1000.0);
      initial_homing = 5;
      //=====================================================================================================      
      while (!digitalRead(xSwitch)) 
      { 
          steppery.moveTo(initial_homing);  
          stepperX.moveTo(initial_homing);  
          steppery.run();
          stepperX.run();
          initial_homing--;
      }
          Travely = -100;
          TravelX = -100;
          //=====================================================================================================
          steppery.moveTo(Travely);  
          stepperX.moveTo(TravelX);
          //=====================================================================================================
          while ((stepperX.distanceToGo() != 0)&&(steppery.distanceToGo() != 0)) 
          {
              stepperX.run();  // Move Stepper into positio
              steppery.run();
          }
      //=====================================================================================================
      steppery.setCurrentPosition(0);
      stepperX.setCurrentPosition(0);
      Serial.println("Found X-Limit");
      //=====================================================================================================
      steppery.setMaxSpeed(2000.0);      
      stepperX.setMaxSpeed(2000.0);      
      steppery.setAcceleration(2000.0);  
      stepperX.setAcceleration(2000.0);
      Serial.println("Enter A Position");
}
//=====================================================================================================
//=====================================================================================================
//=====================================================================================================
void loop() 
{
    while (Serial.available()>0)  
    {
        state = Serial.parseInt();
        move_finished=0;
        //=====================================================================================================
        switch(state)
        {
          case 1:
          Travely = 100;
          TravelX = -100;
          break;
          //=====================================================================================================
          case 2:
          Travely = 300;
          TravelX = -300;
          break;
          //=====================================================================================================
          case 3:
          Travely = 500;
          TravelX = -500;
          break;
          //=====================================================================================================
          case 4:
          Travely = 700;
          TravelX = -700;
          break;
          //=====================================================================================================
          case 5:
          Travely = 900;
          TravelX = -900;
          break;
          //=====================================================================================================
          case 6:
          Travely = 1100;
          TravelX = -1100;
          break;
          //=====================================================================================================
          case 7:
          Travely = 1300;
          TravelX = -1300;
          break;
          //=====================================================================================================
          case 8:
          Travely = 1500;
          TravelX = -1500;
          break;
          //=====================================================================================================
          case 9:
          Travely = -100;
          TravelX = -100;
          break;
          //=====================================================================================================
          case 10:
          Travely = -300;
          TravelX = -300;
          break;
          //=====================================================================================================
          case 11:
          Travely = -500;
          TravelX = -500;
          break;
          //=====================================================================================================
          case 12:
          //=====================================================================================================
          Travely = -700;
          TravelX = -700;
          break;
           //=====================================================================================================
          case 13:
          //=====================================================================================================
          Travely = -900;
          TravelX = -900;
          break;
           //=====================================================================================================
          case 14:
          Travely = -1100;
          TravelX = -1100;
          break;
          //=====================================================================================================
          case 15:
          //=====================================================================================================
          Travely = -1300;
          TravelX = -1300;
          break;
          //=====================================================================================================
          case 16:
          //=====================================================================================================
          Travely = -1500;
          TravelX = -1500;
          break;
         //=====================================================================================================
          case 17:
          Travely = -1880;
          TravelX = -1500;
          //=====================================================================================================
          case 18:
          Travely = 100;
          TravelX = -100;
          break;
        //=====================================================================================================
          case 19:
          move_finished=0;
          //=====================================================================================================
          Travely = 300;
          TravelX = -300;
          break;
          //=====================================================================================================
          case 20:
          Travely = 500;
          TravelX = -500;
          break;
          //=====================================================================================================
          case 21:
          Travely = 700;
          TravelX = -700;
          break;
          //=====================================================================================================
          case 22:
          Travely = 900;
          TravelX = -900;
          break;
          //=====================================================================================================
          case 23:
          Travely = 1100;
          TravelX = -1100;
          break;
          //=====================================================================================================
          case 24:
          Travely = 1300;
          TravelX = -1300;
          break;
          //=====================================================================================================
          case 25:
          Travely = 1500;
          TravelX = -1500;
          break;
          //=====================================================================================================
          case 26:
          Travely = -100;
          TravelX = -100;
          break;
          //=====================================================================================================
          case 27:
          //=====================================================================================================
          Travely = -300;
          TravelX = -300;
          break;
           //=====================================================================================================
          case 28:
          //=====================================================================================================
          Travely = -500;
          TravelX = -500;
          break;
           //=====================================================================================================
          case 29:
          //=====================================================================================================
          Travely = -700;
          TravelX = -700;
          break;
           //=====================================================================================================
          case 30:
          //=====================================================================================================
          Travely = -900;
          TravelX = -900;
          break;
          //=====================================================================================================
          case 31:
          Travely = -1100;
          TravelX = -1100;
          break;
          //=====================================================================================================
          case 32:
          //=====================================================================================================
          Travely = -1300;
          TravelX = -1300;
          break;
          //=====================================================================================================
          case 33:
          Travely = 100;
          TravelX = -100;
          break;
          //=====================================================================================================
          case 34:
          Travely = 300;
          TravelX = -300;
          break;
          //=====================================================================================================
          case 35:
          Travely = 500;
          TravelX = -500;
          break;
          //=====================================================================================================
          case 36:
          Travely = 700;
          TravelX = -700;
          break;
          //=====================================================================================================
          case 37:
          Travely = 900;
          TravelX = -900;
          break;
          //=====================================================================================================
          case 38:
          Travely = 1100;
          TravelX = -1100;
          break;
          //=====================================================================================================
          case 39:
          Travely = 1300;
          TravelX = -1300;
          break;
          //=====================================================================================================
          case 40:
          Travely = 1500;
          TravelX = -1500;
          break;
          //=====================================================================================================
          case 41:
          Travely = -100;
          TravelX = -100;
          break;
          //=====================================================================================================
          case 42:
          Travely = -300;
          TravelX = -300;
          break;
          //=====================================================================================================
          case 43:
          Travely = -500;
          TravelX = -500;
          break;
          //=====================================================================================================
          case 44:
          //=====================================================================================================
          Travely = -700;
          TravelX = -700;
          break;
           //=====================================================================================================
          case 45:
          //=====================================================================================================
          Travely = -900;
          TravelX = -900;
          break;
           //=====================================================================================================
          case 46:
          Travely = -1100;
          TravelX = -1100;
          break;
          //=====================================================================================================
          case 47:
          //=====================================================================================================
          Travely = -1300;
          TravelX = -1300;
          break;
          //=====================================================================================================
          case 48:
          //=====================================================================================================
          Travely = -1500;
          TravelX = -1500;
          break;
         //=====================================================================================================
          case 49:
          Travely = -1880;
          TravelX = -1500;
          //=====================================================================================================
          case 50:
          Travely = 100;
          TravelX = -100;
          break;
        //=====================================================================================================
          case 51:
          Travely = 300;
          TravelX = -300;
          break;
          //=====================================================================================================
          case 52:
          Travely = 500;
          TravelX = -500;
          break;
          //=====================================================================================================
          case 53:
          Travely = 700;
          TravelX = -700;
          break;
          //=====================================================================================================
          case 54:
          Travely = 900;
          TravelX = -900;
          break;
          //=====================================================================================================
          case 55:
          Travely = 1100;
          TravelX = -1100;
          break;
          //=====================================================================================================
          case 56:
          Travely = 1300;
          TravelX = -1300;
          break;
          //=====================================================================================================
          case 57:
          Travely = 1500;
          TravelX = -1500;
          break;
          //=====================================================================================================
          case 58:
          Travely = -100;
          TravelX = -100;
          break;
          //=====================================================================================================
          case 59:
          //=====================================================================================================
          Travely = -300;
          TravelX = -300;
          break;
           //=====================================================================================================
          case 60:
          //=====================================================================================================
          Travely = -500;
          TravelX = -500;
          break;
           //=====================================================================================================
          case 61:
          //=====================================================================================================
          Travely = -700;
          TravelX = -700;
          break;
           //=====================================================================================================
          case 62:
          //=====================================================================================================
          Travely = -900;
          TravelX = -900;
          break;
           //=====================================================================================================
          case 63:
          Travely = -1100;
          TravelX = -1100;
          break;
          //=====================================================================================================
          case 64:
          //=====================================================================================================
          Travely = -1300;
          TravelX = -1300;
          break;
         //=====================================================================================================
          steppery.moveTo(0);  
          stepperX.moveTo(0);
          //=====================================================================================================
         break;
        }
          //=====================================================================================================
          steppery.moveTo(Travely);  
          stepperX.moveTo(TravelX);
          //=====================================================================================================
          while ((stepperX.distanceToGo() != 0)&&(steppery.distanceToGo() != 0)) 
          {
              stepperX.run();  // Move Stepper into positio
              steppery.run();
          }
          if ((move_finished == 0) && (stepperX.distanceToGo() == 0)) 
          {
              Serial.println("COMPLETED!");
              Serial.println("Enter A New Position");
              move_finished=1;  // Reset move variable
          }
          
          //delay(5000);
          //steppery.moveTo(0);  
          stepperX.moveTo(0);
          //=====================================================================================================
          while ((stepperX.distanceToGo() != 0)&&(steppery.distanceToGo() != 0)) 
          {
              stepperX.run();  // Move Stepper into positio
              steppery.run();
          }
          if ((move_finished == 0) && (stepperX.distanceToGo() == 0)) 
          {
              Serial.println("COMPLETED!");
              Serial.println("Enter A New Position");
              move_finished=1;  // Reset move variable
          }
    }
    
  
}
